<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å£çº¸æµè§ˆ</title>
    <link rel="icon" href="./icon.png">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: Arial, sans-serif;
        }

        #header {
            background: #333;
            color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
        }

        #refreshBtn {
            padding: 8px 16px;
            margin-right: 20px;
            cursor: pointer;
            background: #666;
            border: none;
            color: white;
            border-radius: 4px;
            margin-left: auto;
        }

        #container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        #fileTree {
            width: 300px;
            background: #f5f5f5;
            overflow-y: auto;
            padding: 10px;
            border-right: 1px solid #ddd;
        }

        #preview {
            flex: 1;
            padding: 20px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tree-item {
            cursor: pointer;
            padding: 6px;
            user-select: none;
            transition: background 0.2s;
        }

        .tree-item:hover {
            background: #e0e0e0;
        }

        .folder::before {
            content: "ğŸ“ ";
        }

        .file::before {
            content: "ğŸ“„ ";
        }

        .children {
            margin-left: 20px;
            display: none;
        }

        .expanded .children {
            display: block;
        }

        .empty-directory {
            color: #999;
            font-style: italic;
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div id="header">
        <h3>å£çº¸æµè§ˆ</h3>
        <button id="refreshBtn">åˆ·æ–°æ–‡ä»¶æ ‘</button>
    </div>
    <div id="container">
        <div id="fileTree"></div>
        <div id="preview">
            <p>ç‚¹å‡»å·¦ä¾§çš„å›¾ç‰‡æ–‡ä»¶è¿›è¡Œé¢„è§ˆ</p>
        </div>
    </div>

    <script>
        const BASE_URL = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);

        // è·å– DOM å…ƒç´ 
        const refreshBtn = document.getElementById('refreshBtn');
        const fileTree = document.getElementById('fileTree');
        const preview = document.getElementById('preview');

        // åŠ è½½ JSON æ•°æ®å¹¶æ¸²æŸ“æ–‡ä»¶æ ‘
        async function loadFileTree() {
            try {
                const response = await fetch('data.json', {
                    mode: 'cors'
                });
                if (!response.ok) throw new Error('åŠ è½½æ•°æ®å¤±è´¥');
                const data = await response.json();
                fileTree.innerHTML = ''; // æ¸…ç©ºæ—§å†…å®¹
                renderTree(data, fileTree, data.name);
            } catch (err) {
                preview.innerHTML = `<p style="color: red">é”™è¯¯ï¼š${err.message}</p>`;
            }
        }

        // é€’å½’æ¸²æŸ“æ–‡ä»¶æ ‘
        function renderTree(node, parentElement, path) {
            const ul = document.createElement('ul');
            
            node.items.forEach(item => {
                const li = document.createElement('li');
                li.className = 'tree-item';

                if (item.contentType === 'directory') {
                    // æ¸²æŸ“ç›®å½•
                    li.innerHTML = `<div class="folder">${item.name}</div>`;
                    const childrenDiv = document.createElement('div');
                    childrenDiv.className = 'children';
                    li.appendChild(childrenDiv);

                    // å¤„ç†å­é¡¹ï¼ˆé€’å½’ï¼‰
                    if (item.items && item.items.length > 0) {
                        renderTree(item, childrenDiv, `${path}/${item.name}`);
                    } else {
                        childrenDiv.innerHTML = '<div class="empty-directory">ï¼ˆç©ºç›®å½•ï¼‰</div>';
                    }

                    // ç‚¹å‡»å±•å¼€/æŠ˜å 
                    li.querySelector('.folder').addEventListener('click', (e) => {
                        e.stopPropagation();
                        li.classList.toggle('expanded');
                    });
                } else if (item.contentType === 'file') {
                    // æ¸²æŸ“æ–‡ä»¶
                    li.innerHTML = `<div class="file">${item.name}</div>`;
                    
                    // ç‚¹å‡»é¢„è§ˆå›¾ç‰‡
                    li.querySelector('.file').addEventListener('click', () => {
                        const imageUrl = `${BASE_URL}${path}/${item.name}`;
                        preview.innerHTML = `
                            <img 
                                src="${imageUrl}" 
                                style="max-width: 100%; max-height: 80vh; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1)"
                                alt="${item.name}"
                            >
                        `;
                    });
                }
                ul.appendChild(li);
            });
            parentElement.appendChild(ul);
        }

        // åˆå§‹åŒ–
        refreshBtn.addEventListener('click', loadFileTree);
        loadFileTree(); // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½
    </script>
</body>
</html>
