<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å›¾ç‰‡æµè§ˆå™¨</title>
    <style>
        /* CSS å¸ƒå±€ */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #header {
            background: #333;
            color: white;
            padding: 10px;
            display: flex;
            align-items: center;
        }

        #refreshBtn {
            padding: 8px 16px;
            margin-right: 20px;
            cursor: pointer;
        }

        #container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        #fileTree {
            width: 300px;
            background: #f5f5f5;
            overflow-y: auto;
            padding: 10px;
            border-right: 1px solid #ddd;
        }

        #preview {
            flex: 1;
            padding: 20px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* æ–‡ä»¶æ ‘æ ·å¼ */
        .tree-item {
            cursor: pointer;
            padding: 4px;
            user-select: none;
        }

        .tree-item:hover {
            background: #e0e0e0;
        }

        .folder::before {
            content: "ğŸ“ ";
        }

        .file::before {
            content: "ğŸ“„ ";
        }

        .children {
            margin-left: 20px;
            display: none;
        }

        .expanded .children {
            display: block;
        }
    </style>
</head>
<body>
    <!-- é¡µçœ‰ -->
    <div id="header">
        <button id="refreshBtn">åˆ·æ–°æ–‡ä»¶æ ‘</button>
        <h3>å›¾ç‰‡æµè§ˆå™¨</h3>
    </div>

    <!-- ä¸»ä½“å®¹å™¨ -->
    <div id="container">
        <!-- å·¦ä¾§æ–‡ä»¶æ ‘ -->
        <div id="fileTree"></div>

        <!-- å³ä¾§å›¾ç‰‡é¢„è§ˆ -->
        <div id="preview">
            <p>ç‚¹å‡»å·¦ä¾§æ–‡ä»¶æ ‘ä¸­çš„å›¾ç‰‡æ–‡ä»¶è¿›è¡Œé¢„è§ˆ</p>
        </div>
    </div>

    <script>
        // è·å– DOM å…ƒç´ 
        const refreshBtn = document.getElementById('refreshBtn');
        const fileTree = document.getElementById('fileTree');
        const preview = document.getElementById('preview');

        // å¤„ç†ç›®å½•é€‰æ‹©ä¸æ–‡ä»¶æ ‘ç”Ÿæˆ
        async function loadDirectory() {
            try {
                // è¯·æ±‚ç”¨æˆ·é€‰æ‹©ç›®å½•
                const dirHandle = await window.showDirectoryPicker();
                fileTree.innerHTML = ''; // æ¸…ç©ºæ—§æ–‡ä»¶æ ‘
                await buildFileTree(dirHandle, fileTree);
            } catch (err) {
                console.error('Error accessing directory:', err);
            }
        }

        // é€’å½’æ„å»ºæ–‡ä»¶æ ‘
        async function buildFileTree(dirHandle, parentElement) {
            const ul = document.createElement('ul');
            for await (const entry of dirHandle.values()) {
                const li = document.createElement('li');
                li.className = 'tree-item';
                
                if (entry.kind === 'directory') {
                    // å¤„ç†ç›®å½•
                    li.innerHTML = `<div class="folder">${entry.name}</div>`;
                    const childrenDiv = document.createElement('div');
                    childrenDiv.className = 'children';
                    li.appendChild(childrenDiv);

                    // ç‚¹å‡»ç›®å½•å±•å¼€/æŠ˜å 
                    li.querySelector('.folder').addEventListener('click', (e) => {
                        e.stopPropagation();
                        li.classList.toggle('expanded');
                    });

                    // é€’å½’å­ç›®å½•
                    await buildFileTree(entry, childrenDiv);
                } else if (entry.kind === 'file' && isImageFile(entry.name)) {
                    // å¤„ç†å›¾ç‰‡æ–‡ä»¶
                    li.innerHTML = `<div class="file">${entry.name}</div>`;
                    
                    // ç‚¹å‡»æ–‡ä»¶é¢„è§ˆå›¾ç‰‡
                    li.querySelector('.file').addEventListener('click', async (e) => {
                        e.stopPropagation();
                        const file = await entry.getFile();
                        const url = URL.createObjectURL(file);
                        preview.innerHTML = `<img src="${url}" style="max-width: 100%; max-height: 80vh;">`;
                    });
                }
                ul.appendChild(li);
            }
            parentElement.appendChild(ul);
        }

        // åˆ¤æ–­æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶
        function isImageFile(filename) {
            return /\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(filename);
        }

        // åˆ·æ–°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        refreshBtn.addEventListener('click', loadDirectory);

        // åˆå§‹åŒ–æç¤º
        preview.innerHTML = '<p>è¯·å…ˆç‚¹å‡»"åˆ·æ–°æ–‡ä»¶æ ‘"æŒ‰é’®é€‰æ‹©åŒ…å«å›¾ç‰‡çš„ç›®å½•</p>';
    </script>
</body>
</html>
